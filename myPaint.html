<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Paint</title>
	<link rel="stylesheet" href="css/bootstrap.css">
	<style>
		#myCanvas{
			border: 1px solid red;
		}
		#tools{
			border: 1px solid black;
			width: 800px;
		}		
	</style>
</head>
<body>
	<canvas id="myCanvas" width="800" height="500"></canvas>
	<div id="tools" class="dropdown">
		<button data-toggle="dropdown" class="btn btn-primary dropdown-toggle"> <span id="kind">선택안함</span>&nbsp;<span class="caret"></span></button>
		<ul class="dropdown-menu">
			<li><a id="none" href="#">선택안함</li>
			<li><a id="line" href="#">선</li>
			<li><a id="rect" href="#">사각형</li>
			<li><a id="roundRect" href="#">둥근 사각형</li>
			<li><a id="circle" href="#">원</li>
		</ul>
	</div>
	<p id="downInfo"></p>
	<p id="info"></p>
	<script src="js/jquery-3.3.1.js"></script>
	<script src="js/bootstrap.js"></script>
	<script>
		var canvas = document.querySelector("#myCanvas");
		var context = canvas.getContext("2d");

		var drawType = { 
			none: "none",
			line: "line", 
			rect: "rect",
			roundRect: "roundRect",
			circle: "circle",
			poly: "poly"
		}

		var currentDrawType = drawType.none;

		var isDown = false;
		var prev = { X: 0,  Y: 0, W: 0, H: 0 };
		var boxW = 1, boxHarf = (boxW / 2);

		var drawObj = [];

		var clearPrevRect = function(){
			if(prev.W < 0) {
				if(prev.H < 0) {
					context.clearRect(prev.X + boxHarf + (boxW % 2), 
						              prev.Y + boxHarf, 
						              prev.W - boxW - (boxW % 2), 
						              prev.H - boxW - (boxW % 2));
				} else {
					context.clearRect(prev.X + boxHarf + (boxW % 2), 
						              prev.Y - boxHarf - (boxW % 2), 
						              prev.W - boxW - (boxW % 2), 
						              prev.H + boxW + (boxW % 2));
				}
			} else {
				if(prev.H < 0) {
					context.clearRect(prev.X - boxHarf, 
						              prev.Y + boxHarf, 
						              prev.W + boxW + (boxW % 2), 
						              prev.H - boxW - (boxW % 2));
				} else {
					context.clearRect(prev.X - boxHarf, 
						              prev.Y - boxHarf - (boxW % 2), 
						              prev.W + boxW + (boxW % 2), 
						              prev.H + boxW + (boxW % 2));
				}
			}
		};

		var drawRectangle = function(){
			clearPrevRect();
			var w = event.offsetX - prev.X;
			var h = event.offsetY - prev.Y;

			context.strokeStyle="#ff0000";
			context.strokeRect(prev.X, prev.Y, w, h);
			prev.W = w;
			prev.H = h;

			$("#info").text("prevX: " + prev.X + " , prevY: " + prev.Y + "   /   w: " + w + "   ,   h: " + h);
		};

		var drawLine = function(){
			
		};
		
		var draw = function(event){
			switch(currentDrawType){
				case drawType.rect:
					drawRectangle();
					break;

				case drawType.line:
					drawLine();
					break;
			}
		}

		$("#tools>ul>li a").click(function(){
			$("#kind").text($(this).text());
			currentDrawType = $(this).attr("id");
		});

		$("#myCanvas").mousedown(function(event){
			if(currentDrawType != drawType.none) {
				prev.X = event.offsetX;
				prev.Y = event.offsetY;
				prev.W = 0;
				prev.H = 0;
				isDown = true;
				$("#downInfo").text("x: " + event.offsetX + "   ,   y: " + event.offsetY);
			}
		});

		$("#myCanvas").mousemove(function(event){
			if(isDown) {
				draw(event);
			}
		});

		$("#myCanvas").mouseup(function(event){
			if(isDown) {
				draw(event);
				var obj = {
					kind: currentDrawType,
					x: prev.X,
					y: prev.Y,
					w: prev.W,
					h: prev.H,
					color: "#ff0000"
				}
				drawObj.push(obj);
				isDown = false;
			}
		});

		var drawTmr = setInterval(function(){
			for(var i=0; i<drawObj.length; i++){
				var tmp = drawObj[i];
				switch(tmp.kind){
					case drawType.rect:
						context.strokeStyle = tmp.color;
						context.strokeRect(tmp.x, tmp.y, tmp.w, tmp.h);
				}
			}
		}, 200);
	</script>
</body>
</html>